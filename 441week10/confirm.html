<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Confirm Order - E-commerce App</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header class="app-header">
        <div class="container">
            <h1 class="app-title">E-commerce App</h1>
            <nav class="main-nav">
                <div class="logo">
                    <img src="logo.png" alt="E-Commerce App Logo">
                </div>
                <a href="index.html" class="nav-link">Home</a>
                <a href="cart.html" class="nav-link">Shopping Cart</a>
                <a href="check.html" class="nav-link active">check out</output></a>
                <div id="user-greeting" class="user-greeting"></div>
            </nav>
        </div>
    </header>

    <main class="container">
        <section class="order-confirmed">
            <h2>Order Summary</h2>
            
            <div class="order-items">
                <ul class="order-items-list" id="order-items-list">
                    <!-- Order items will be dynamically inserted here -->
                </ul>
            </div>
            
            <div id="order-total-display" class="order-total-display">
                <!-- Total price will be dynamically inserted here -->
            </div>
            
            <div class="order-actions">
                <button id="edit-order" class="edit-order-btn">Edit Order</button>
                <button id="confirm-order" class="confirm-order-btn">Confirm Order</button>
            </div>
        </section>
    </main>

    <script>
        // 当前用户和购物车数据
        let currentUser = JSON.parse(localStorage.getItem('currentUser'));
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        
        // 检查登录状态
        if (!currentUser) {
            window.location.href = 'index.html';
        } else {
            document.getElementById('user-greeting').textContent = `Welcome, ${currentUser.username}!`;
        }

        // 显示订单摘要
        function displayOrderSummary() {
            const orderItemsList = document.getElementById('order-items-list');
            const orderTotalDisplay = document.getElementById('order-total-display');
            
            if (cart.length === 0) {
                orderItemsList.innerHTML = '<li class="empty-order">Your cart is empty</li>';
                orderTotalDisplay.textContent = 'Total: $0.00';
                document.getElementById('confirm-order').disabled = true;
                return;
            }
            
            orderItemsList.innerHTML = '';
            
            cart.forEach(item => {
                const orderItem = document.createElement('li');
                orderItem.className = 'order-item';
                orderItem.innerHTML = `
                    <span class="item-name">${item.name}</span>
                    <span class="item-quantity">Qty: ${item.quantity}</span>
                    <span class="item-price">$${(item.price * item.quantity).toFixed(2)}</span>
                `;
                orderItemsList.appendChild(orderItem);
            });
            
            const total = calculateTotal();
            orderTotalDisplay.textContent = `Total: $${total.toFixed(2)}`;
        }
        
        // 计算总价
        function calculateTotal() {
            return cart.reduce((total, item) => {
                return total + (item.price * item.quantity);
            }, 0);
        }
        
        // 显示消息
        function showMessage(message, type) {
            const messageContainer = document.createElement('div');
            messageContainer.className = `message ${type}`;
            messageContainer.textContent = message;
            
            document.body.appendChild(messageContainer);
            
            setTimeout(() => {
                messageContainer.remove();
            }, 3000);
        }
        
        // 初始化页面
        document.addEventListener('DOMContentLoaded', function() {
            displayOrderSummary();
            
            // 编辑订单按钮 - 返回购物车页面
            document.getElementById('edit-order').addEventListener('click', function() {
                window.location.href = 'cart.html';
            });
            
            // 确认订单按钮
            document.getElementById('confirm-order').addEventListener('click', function() {
                if (cart.length === 0) {
                    showMessage('Your cart is empty!', 'error');
                    return;
                }
                
                // 创建订单对象
                const order = {
                    userId: currentUser.username,
                    items: [...cart],
                    total: calculateTotal(),
                    date: new Date().toISOString()
                };
                
                // 获取现有订单或创建新数组
                let orders = JSON.parse(localStorage.getItem('orders')) || [];
                
                // 添加新订单
                orders.push(order);
                localStorage.setItem('orders', JSON.stringify(orders));
                
                // 清空购物车
                cart = [];
                localStorage.setItem('cart', JSON.stringify(cart));
                
                // 显示成功消息并重定向
                showMessage('Order confirmed successfully!', 'success');
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 1500);
            });
        });
    </script>
</body>
</html>